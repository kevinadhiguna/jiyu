
## Enumeration

### enum4linux

Example target: `192.168.1.10`

```sh
enum4linux -a 192.168.1.10
```

| Option | Description                                         |
| ------ | --------------------------------------------------- |
| `-a`   | Do **all** available checks (recommended for recon) |
| `-U`   | Enumerate **users**                                 |
| `-S`   | Enumerate **shares**                                |
| `-G`   | Enumerate **groups**                                |
| `-P`   | Enumerate **password policy**                       |
| `-r`   | Enumerate **RID cycling** for users/groups          |
| `-o`   | Enumerate **OS information**                        |
| `-h`   | Show **help**                                       |


#### Nmap

Example target: `192.168.1.10`

```sh
nmap -sV -sC -sT -p- 192.168.1.10
```

| Option            | Description                                        |
| ----------------- | -------------------------------------------------- |
| `-sS`             | **SYN scan** (stealthy and fast)                   |
| `-sT`             | **TCP connect** scan (less stealthy)               |
| `-sU`             | **UDP scan**                                       |
| `-sV`             | **Service version detection**                      |
| `-sC`             | Run Nmap scripts (particularly to reveal types of the software, like Vsftpd which is a type of FTP)                      |
| `-O`              | **OS detection**                                   |
| `-A`              | Aggressive scan: OS, services, traceroute, scripts |
| `-p`              | Specify port(s) (e.g., `-p 22`, `-p 1-1000`)       |
| `-p-`             | Scan all ports                                     |
| `-Pn`             | Skip host discovery (use if ICMP is blocked)       |
| `-T4`             | Set timing template for faster scanning            |
| `-oN` / `-oX`     | Output results to file (normal/XML)                |
| `--script=<name>` | Run specific NSE script(s)                         |

Note: `-sT` is similar with SYN scans but sends more packets. It is loud in network and easily detectable. However, this is used by default even if you don't specify it.


##### Fast and Verbose scan

Background question: What do you think if you do the following?
```sh
nmap 192.168.1.10
```
Nmap scans 1000 most commonly used ports.

If you want to do the scan faster, you can use the `-F` parameter in order to only scan 100 most commonly used ports:
```sh
nmap -F 192.168.1.10
```

If you want to see what's going on in the scan process, you can use `-v` to verbose it:
```sh
nmap -F 192.168.1.10 -v
```


##### Scan a particular port

```sh
nmap -p 80 192.168.1.10
```

Want to skip ping to avoid 'Host seems down'? Use this:

```sh
nmap -Pn -p 80 192.168.1.10
```

##### Scan several ports

```sh
nmap -Pn -p 21,22,25,80,445,3389,8080 192.168.1.10
```

Note: If you see 'filtered' in the 'STATE' column of an nmap scan result, there is a good chance that a firewall exists in the system (target).

Also, this is how to see if a firewall is within the system you're in (localhost = 127.0.0.1):
```sh
nmap -Pn -p 21,22,25,80,445,3389,8080 127.0.0.1
```


##### Scan all ports

```sh
nmap -p- 192.168.1.10
```

To avoid 'Host seems down':
```sh
nmap -Pn -p- 192.168.1.10
```

In order to increase the speed of the scan (More vulnerable to IDS though):
```sh
nmap -Pn -T4 -p- 192.168.1.10
```

Rule of thumb: 
```
NEVER assume that every system is configured the same, be it Windows, Linux, or other systems. You may end up finding services running on other ports (which is actually common in real world).
```

##### Skip ping

Note: important, especially if a "normal" scan (without params) says "Host seems down"

```sh
nmap -Pn 192.168.1.10
```

##### UDP Scan

Note: Nmap does TCP scan by default

```sh
nmap -sU 192.168.1.10
```

##### Service and OS Detection Scan

```sh
### Service scan
nmap -sV 192.168.1.10
```

```sh
### Service and OS detection scan
nmap -sV -O 192.168.1.10
```

##### Default Scripts Scan

```sh
nmap -sC 192.168.1.10
```

##### Output to a file

Save the terminal output

```sh
nmap 192.168.1.10 -oN nmap_scan
```

Save the output into an XML format (can be imported to Metasploit)

```sh
nmap -oX nmap_scan 192.168.1.10
```

Save thr output into: Normal (.nmap), XML (.xml), and Grepable (.gnmap) formats

```sh
nmap -oA nmap_scan 192.168.1.10
```

##### Aggressive scan

Note: `-A` = `-sV` + `-O` + `-sC`

```sh
nmap -A 192.168.1.10
```

##### 'Skip ping' scan

Background: there are some cases in which if you perform 
```sh
nmap 192.168.1.10
```
Nmap will reply with 'Host seems down' and not even continue to port scanning. This is because Nmap carries out host discovery, then do port scanning.

In order to avoid such cases, you can do a "don't ping" scan:

```sh
nmap -Pn 192.168.1.10 
```


##### TCP-SYN ping scans: One of the most accurate way to tell if a host is up (host discovery)

Port 3389 as an example:

```sh
nmap -sn -PS3389 192.168.1.10
```

Several ports as an example:

```sh
nmap -sn -PS80,3389,445 192.168.1.10
```

A range of ports as an example:

```sh
nmap -sn -PS1-1000 192.168.1.10
```

Important note: When doing host discovery, `nmap -PS80,3390,445 192.168.1.10` takes longer than `nmap -sn -PS80,3389,445` because `-sn` skips port scanning and does ping scans.


##### TCP-ACK pings: not recommended for host discovery

Note: Not recommended for host discovery because certain systems might be configured to block packets with ACK flags set. (But might be useful for firewall discovery?)

Sending packets without SYN:

```sh
nmap -sn -PA 192.168.1.10
```

##### ICMP ping scans

Host discovery ICMP echo requests:
```sh
nmap -sn -PE 192.168.1.10 --send-ip
```

##### Firewall & IDS Evasion

(1) Using fragmented packets

The idea is to send packets in smaller packets so IDS can not analyze them, whether those are packets to be flagged or not.

Note: `-f` to send fragmented packets

```sh
nmap -Pn -sS -sV -p- -f 192.168.1.10
```

```sh
nmap -sV -O -sC -f --data-length 200 192.168.1.10
```

Note: `--mtu` means maximum transmitted units. The size of mtu is > 0 and a multiple of 8.


```sh
nmap -sV -O -sC -f --mtu 8 192.168.1.10
```

(2) Using decoy IP addresses

```sh
nmap -Pn -sS -sV -sV -p- -f --data-length 200 -D 192.168.1.63,192.168.1.65 192.168.1.10
```

Note:
- Decoy IPs are `192.168.1.63` and `192.168.1.65`
- The target IP is `192.168.1.10`


##### My go-to

```sh
nmap -Pn -sS -sV -O -sC -p- 192.168.1.10 -v
```

or

```sh
nmap -Pn -sS -A -p- 192.168.1.10 -v
```

Note: 
- Another case: Ping scans for a general sweep of the network -> TCP-SYN ping scans (for systems that might block ping scans)

Other good examples (these are for host discovery):

```sh
nmap -sn -T4 192.168.1.10 -v
```

```sh
nmap -sn -PS21,22,25,80,445,3389,8080 -T4 192.168.1.10 -v
```

In the event of Windows, combine with UDP scanning using `-PU`:
(because some firewalls might be configured only for TCP, not for UDP...)

```sh
nmap -sn -PS21,22,25,80,445,3389,8080 -PU137,138 -T4 192.168.1.10 -v
```

Scanning an entire network? Just specify the subnet:
(This takes longer because it scans a bunch of IPs)

```sh
nmap -sn -PS21,22,25,80,445,3389,8080 -PU137,138 -T4 192.168.1.0/24 -v
```

Note: in order to specify the subnet, run `ifconfig` or `ip a s`.


### Metasploit

Start PostgreSQL:
```sh
sudo service postgresql start
```

Check PostgreSQL setatus:
```sh
service postgresql status
```

Start msfconsole:
```sh
msfconsole
```

Check database connection in msfonsole:
```sh
db_status
```


#### Metasploit modules

Metasploit modules are primarily stored in `/usr/share/metasploit-framework/modules`:

```sh
$ ls /usr/share/metasploit-framework/modules 
auxiliary  encoders  evasion  exploits  nops  payloads  post  README.md
```


#### Create a workspace in Metasploit

By default, the workspace is `default`. It is recommended to create a workspace per project.

Create a workspace:
```sh
workspace -a smb_enum
```
msfconsole will switch to the created workspace immediately.

#### Import an Nmap scan into Metasploit

Let's say you saved Nmap output with a command such as `nmap <target> -oA scanresult`. 

One of the output is an XML file which can be imported into Metasploit:
```sh
db_import scanresult.xml
```

Note: You can also import other files such as Nessus scan reports.
For more details, check:
```sh
db_import
```

Next, you can check:
```sh
hosts
```

See services in the scan output:
```sh
services
```

#### Running Nmap in Metasploit

```sh
db_nmap 192.168.1.10
```

One can also use a variety of options when running Nmap in Metasploit:
```sh
db_nmap -Pn -sV -sO -sC -p- 192.168.1.10
```


### SSH

```sh
ssh root@192.168.10
```

If there's a private key:
```sh
ssh -i id_rsa root@192.168.1.10
```


### FTP

```sh
ftp 192.168.1.10
```


### SMBclient

```sh
smbclient -L //192.168.1.10 -N
```

| Option       | Description                 |
| ------------ | --------------------------- |
| `-L //<IP>`  | List available shares       |
| `-U <user>`  | Username                    |
| `-N`         | No password (guest access)  |
| `//<IP>/share` | Connect to a specific share |


### LinEnum

```sh
./LinEnum.sh -s -k keyword -r report -e /tmp/ -t
```

| **Option** | **Description**                                                                  | **Example Command**                   |
| ---------- | -------------------------------------------------------------------------------- | ------------------------------------- |
| `-k`   | Enter **keyword** to search for during enumeration (e.g., "sudo", "password").   | `./LinEnum.sh -k "sudo"`              |
| `-e`   | Enter **export location** to save the output report.                             | `./LinEnum.sh -e /path/to/output/dir` |
| `-t`   | Include **thorough (lengthy) tests** to provide more detailed results.           | `./LinEnum.sh -t`                     |
| `-s`   | Supply **current user password** to check sudo permissions (INSECURE).           | `./LinEnum.sh -s password123`         |
| `-r`   | Enter **report name** to save the output as a specific file name (e.g., `.txt`). | `./LinEnum.sh -r linenum_report`      |
| `-h`   | Display this help text with all available options.                           | `./LinEnum.sh -h`                     |


### LDAPsearch

```sh
ldapsearch -x -h <IP> -s base
```

| Option | Description                            |
| ------ | -------------------------------------- |
| `-x`   | Simple authentication                  |
| `-h`   | LDAP server IP                         |
| `-b`   | Base DN (e.g., `dc=example,dc=com`)    |
| `-s`   | Search scope (`base`, `one`, or `sub`) |


### RPCclient

```sh
rpcclient -U "" <target>
```

| Option  | Description                   |
| ------- | ----------------------------- |
| `-U ""` | Anonymous login               |
| `-c`    | Run commands inside the shell |

Useful commands:

```sh
rpcclient $> enumdomusers
```

```sh
rpcclient $> queryuser <RID>
```

```sh
rpcclient $> netshareenum
```


### NMB Lookup

```sh
nmblookup -A 192.168.1.10
```

| Option  | Description                   |
| ------- | ----------------------------- |
| `-A <IP Address>` | lookup by IP to connect to a serverâ€™s NetBIOS info and list server connection information              |


### Hydra

```sh
hydra <flags> <IP_Address> <protocol>
```

| Option  | Description                   |
| ------- | ----------------------------- |
| `-l <username>` | login name |
| `-P <path/to/file>` | path to password wordlist |
| `-L <path/to/file>` | login username wordlist |

This will try to login to the SMB server at the IP address with the username admin trying passwords found in the rockyou txt file:
```sh
hydra -l admin -P /usr/share/wordlists/rockyou.txt 192.168.1.10 smb
```

FTP:
```sh
hydra -t 4 -L /usr/share/metasploit-framework/data/wordlists/common_users.txt -P /usr/share/wordlists/rockyou.txt -v 192.168.1.10 ftp
```

or if you target a domain:
```sh
hydra -t 4 -L /usr/share/metasploit-framework/data/wordlists/common_users.txt -P /usr/share/wordlists/rockyou.txt -v demo.exampledomain.net ftp
```


### Directory Buster

Enumerate directories of a website from a wordlist

#### dirb

```sh
dirb example.com ~/SecList/wordlists/Discovery/Web-Content/common.txt
```

#### gobuster

```sh
gobuster dir -u example.com -w ~/SecList/wordlists/Discovery/Web-Content/common.txt
```


### Networking

#### Linux

```sh
ip route
```

#### Windows

```sh
route print
```

#### Mac OS X/Linux

```sh
netstat -r
```

### Information Gathering (Passive)

Help enumerate website information

```sh
whatweb 192.168.1.10
```

```sh
host example.com
```

#### DNS

```sh
whois example.com
whois 192.168.1.10
```

Note: Be careful using dnsenum. It carries out bruteforce by default.

```sh
dnsenum example.com
```


## Resources

- [Web Application Attacks](https://www.netsecfocus.com/oscp/2021/05/06/The_Journey_to_Try_Harder-_TJnull-s_Preparation_Guide_for_PEN-200_PWK_OSCP_2.0.html#section-9-web-application-attacks)
- [Hacking the OSCP: Web Apps](https://securing.dev/posts/hacking-the-oscp-web-apps/)
- [GTFO Bins - Unix binaries to bypass local security restrictions](https://gtfobins.github.io/)
- [Shellter](https://www.shellterproject.com/homepage/)
- [INE Training Notes - syselement](https://blog.syselement.com/ine/courses/ejpt/ejpt-cheatsheet)
